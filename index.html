<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Model Serving Platform</title>
		<style>
			:root {
				--primary-color: #2563eb;
				--secondary-color: #1e40af;
				--background-color: #f3f4f6;
				--surface-color: #ffffff;
				--text-color: #1f2937;
				--error-color: #dc2626;
				--success-color: #16a34a;
			}

			body {
				font-family:
					"Inter",
					-apple-system,
					BlinkMacSystemFont,
					"Segoe UI",
					Roboto,
					sans-serif;
				background-color: var(--background-color);
				color: var(--text-color);
				margin: 0;
				padding: 2rem;
				line-height: 1.5;
			}

			.container {
				max-width: 800px;
				margin: 0 auto;
				background-color: var(--surface-color);
				padding: 2rem;
				border-radius: 0.5rem;
				box-shadow:
					0 4px 6px -1px rgba(0, 0, 0, 0.1),
					0 2px 4px -1px rgba(0, 0, 0, 0.06);
			}

			header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 2rem;
				border-bottom: 1px solid #e5e7eb;
				padding-bottom: 1rem;
			}

			h1 {
				font-size: 1.5rem;
				font-weight: 700;
				margin: 0;
				color: var(--primary-color);
			}

			.status-badge {
				padding: 0.25rem 0.75rem;
				border-radius: 9999px;
				font-size: 0.875rem;
				font-weight: 500;
				background-color: #e5e7eb;
				color: #4b5563;
			}

			.status-badge.online {
				background-color: #dcfce7;
				color: var(--success-color);
			}

			.status-badge.offline {
				background-color: #fee2e2;
				color: var(--error-color);
			}

			.section {
				margin-bottom: 2rem;
			}

			h2 {
				font-size: 1.25rem;
				font-weight: 600;
				margin-bottom: 1rem;
			}

			.form-group {
				margin-bottom: 1rem;
			}

			label {
				display: block;
				font-weight: 500;
				margin-bottom: 0.5rem;
			}

			select,
			textarea,
			input {
				width: 100%;
				padding: 0.5rem;
				border: 1px solid #d1d5db;
				border-radius: 0.375rem;
				font-family: inherit;
				font-size: 1rem;
			}

			textarea {
				min-height: 100px;
				font-family: monospace;
			}

			button {
				background-color: var(--primary-color);
				color: white;
				padding: 0.5rem 1rem;
				border: none;
				border-radius: 0.375rem;
				font-weight: 500;
				cursor: pointer;
				transition: background-color 0.15s ease-in-out;
			}

			button:hover {
				background-color: var(--secondary-color);
			}

			button:disabled {
				background-color: #9ca3af;
				cursor: not-allowed;
			}

			#result-area {
				margin-top: 1rem;
				padding: 1rem;
				background-color: #f8fafc;
				border: 1px solid #e2e8f0;
				border-radius: 0.375rem;
				white-space: pre-wrap;
				font-family: monospace;
				display: none;
			}

			#result-area.error {
				border-color: var(--error-color);
				background-color: #fef2f2;
				color: var(--error-color);
			}
		</style>
	</head>
	<body>
		<div class="container">
			<header>
				<h1>Model Serving Platform</h1>
				<span id="server-status" class="status-badge">Checking...</span>
			</header>

			<div class="section">
				<h2>Make a Prediction</h2>
				<form id="prediction-form">
					<div class="form-group">
						<label for="model-select">Select Model</label>
						<select id="model-select" required>
							<option value="" disabled selected>
								Loading models...
							</option>
						</select>
					</div>

					<div class="form-group">
						<label for="input-data"
							>Input Data (JSON - Array of Features)</label
						>
						<textarea
							id="input-data"
							placeholder="Example: [5.1, 3.5, 1.4, 0.2]"
							required
						></textarea>
					</div>

					<button type="submit" id="predict-btn">Predict</button>
				</form>

				<div id="result-area"></div>
			</div>
		</div>

		<script>
			const API_BASE =
				"https://model-serving-platform-production.up.railway.app";

			// Elements
			const statusBadge = document.getElementById("server-status");
			const modelSelect = document.getElementById("model-select");
			const predictionForm = document.getElementById("prediction-form");

			const inputData = document.getElementById("input-data");
			const predictBtn = document.getElementById("predict-btn");
			const resultArea = document.getElementById("result-area");

			// Check Health
			async function checkHealth() {
				try {
					const res = await fetch(`${API_BASE}/health`);
					if (res.ok) {
						statusBadge.textContent = "System Online";
						statusBadge.className = "status-badge online";
					} else {
						throw new Error("Health check failed");
					}
				} catch (error) {
					statusBadge.textContent = "System Offline";
					statusBadge.className = "status-badge offline";
					console.error("Health check error:", error);
				}
			}

			// Fetch Models
			async function fetchModels() {
				try {
					const res = await fetch(`${API_BASE}/models`);
					if (!res.ok) throw new Error("Failed to fetch models");

					const data = await res.json();
					modelSelect.innerHTML =
						'<option value="" disabled selected>Select a model</option>';

					// Handle different response structures if necessary, assuming { models: [...] } or [...]
					const models = data.models || data;

					if (Array.isArray(models)) {
						models.forEach((model) => {
							const modelName = model;
							const userModelName = model;
							const option = document.createElement("option");
							option.value = modelName;
							option.textContent = userModelName;
							modelSelect.appendChild(option);
						});
					} else {
						modelSelect.innerHTML =
							'<option value="" disabled>No models found</option>';
					}
				} catch (error) {
					console.error("Error fetching models:", error);
					modelSelect.innerHTML =
						'<option value="" disabled>Error loading models</option>';
				}
			}

			// Handle Prediction
			predictionForm.addEventListener("submit", async (e) => {
				e.preventDefault();
				const modelName = modelSelect.value;
				const rawInput = inputData.value;

				if (!modelName) {
					alert("Please select a model");
					return;
				}

				let parsedInput;
				try {
					parsedInput = JSON.parse(rawInput);
				} catch (error) {
					alert("Invalid JSON input");
					return;
				}

				predictBtn.disabled = true;
				predictBtn.textContent = "Running...";
				resultArea.style.display = "none";
				resultArea.className = "";

				try {
					const res = await fetch(`${API_BASE}/predict`, {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							model_id: modelName,
							features: parsedInput,
						}),
					});

					const data = await res.json();

					resultArea.style.display = "block";
					if (!res.ok) {
						resultArea.className = "error";
						resultArea.textContent = `Error: ${data.error || "Prediction failed"}`;
					} else {
						resultArea.textContent = JSON.stringify(data, null, 2);
					}
				} catch (error) {
					console.error("Prediction error:", error);
					resultArea.style.display = "block";
					resultArea.className = "error";
					resultArea.textContent =
						"Network error or server unavailable";
				} finally {
					predictBtn.disabled = false;
					predictBtn.textContent = "Predict";
				}
			});

			// Initialize
			checkHealth();
			fetchModels();
		</script>
	</body>
</html>
